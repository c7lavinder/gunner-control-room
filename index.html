<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gunner Control Room</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0e17;--card:#131a2b;--card-hover:#1a2340;--border:#1e2a45;--text:#e2e8f0;--text-dim:#64748b;--green:#22c55e;--yellow:#eab308;--red:#ef4444;--blue:#3b82f6;--purple:#a855f7;--accent:#3b82f6;--panel-bg:#0f1525}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
/* Animated background */
body::before{content:'';position:fixed;top:0;left:0;right:0;bottom:0;background:radial-gradient(ellipse at 20% 50%,rgba(59,130,246,0.08) 0%,transparent 50%),radial-gradient(ellipse at 80% 20%,rgba(168,85,247,0.06) 0%,transparent 50%),radial-gradient(ellipse at 50% 80%,rgba(34,197,94,0.05) 0%,transparent 50%);pointer-events:none;z-index:0}

/* Header */
.header{position:sticky;top:0;z-index:100;background:rgba(10,14,23,0.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:16px 24px}
.header-inner{max-width:1400px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px}
.logo-area{display:flex;align-items:center;gap:14px}
.logo-icon{width:44px;height:44px;background:linear-gradient(135deg,var(--blue),var(--purple));border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;box-shadow:0 0 20px rgba(59,130,246,0.3)}
.logo-text h1{font-size:22px;font-weight:700;background:linear-gradient(135deg,#e2e8f0,#94a3b8);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.logo-text p{font-size:12px;color:var(--text-dim);letter-spacing:1px;text-transform:uppercase}
.stats-bar{display:flex;gap:20px;flex-wrap:wrap}
.stat{display:flex;align-items:center;gap:8px;padding:8px 16px;background:var(--card);border:1px solid var(--border);border-radius:10px}
.stat .dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.stat .dot.green{background:var(--green);box-shadow:0 0 8px var(--green)}
.stat .dot.yellow{background:var(--yellow);box-shadow:0 0 8px var(--yellow)}
.stat .dot.red{background:var(--red);box-shadow:0 0 8px var(--red)}
.stat .num{font-size:18px;font-weight:700}
.stat .label{font-size:11px;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.5px}

/* Main */
.main{max-width:1400px;margin:0 auto;padding:24px;position:relative;z-index:1}

/* Engine Section */
.engine{margin-bottom:32px}
.engine-header{display:flex;align-items:center;gap:12px;margin-bottom:16px;padding-bottom:8px;border-bottom:1px solid var(--border)}
.engine-badge{padding:4px 12px;border-radius:6px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px}
.engine-badge.live{background:rgba(34,197,94,0.15);color:var(--green);border:1px solid rgba(34,197,94,0.3)}
.engine-badge.built{background:rgba(59,130,246,0.15);color:var(--blue);border:1px solid rgba(59,130,246,0.3)}
.engine-badge.planned{background:rgba(234,179,8,0.15);color:var(--yellow);border:1px solid rgba(234,179,8,0.3)}
.engine-title{font-size:16px;font-weight:600;color:var(--text)}
.engine-subtitle{font-size:13px;color:var(--text-dim)}

/* Desk Grid */
.desk-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}

/* Desk Card */
.desk{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:20px;cursor:pointer;transition:all 0.25s ease;position:relative;overflow:hidden}
.desk:hover{background:var(--card-hover);border-color:rgba(59,130,246,0.3);transform:translateY(-2px);box-shadow:0 8px 30px rgba(0,0,0,0.3)}
.desk::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;border-radius:14px 14px 0 0;opacity:0;transition:opacity 0.25s}
.desk:hover::before{opacity:1}
.desk.status-online::before{background:linear-gradient(90deg,var(--green),var(--blue))}
.desk.status-idle::before{background:linear-gradient(90deg,var(--yellow),#f97316)}
.desk.status-offline::before{background:linear-gradient(90deg,var(--red),#dc2626)}
.desk-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:14px}
.bot-avatar{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;position:relative}
.bot-avatar.online{background:rgba(34,197,94,0.12);border:1px solid rgba(34,197,94,0.25)}
.bot-avatar.idle{background:rgba(234,179,8,0.12);border:1px solid rgba(234,179,8,0.25)}
.bot-avatar.offline{background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.2)}
.status-dot{position:absolute;bottom:-2px;right:-2px;width:14px;height:14px;border-radius:50%;border:3px solid var(--card)}
.status-dot.online{background:var(--green);box-shadow:0 0 6px var(--green)}
.status-dot.idle{background:var(--yellow);box-shadow:0 0 6px var(--yellow)}
.status-dot.offline{background:var(--red);box-shadow:0 0 6px var(--red)}
.desk-actions{font-size:11px;color:var(--text-dim);background:rgba(255,255,255,0.05);padding:3px 8px;border-radius:6px}
.bot-name{font-size:14px;font-weight:600;margin-bottom:4px}
.bot-desc{font-size:12px;color:var(--text-dim);line-height:1.4}
.bot-meta{display:flex;align-items:center;gap:8px;margin-top:12px;padding-top:10px;border-top:1px solid rgba(255,255,255,0.05)}
.bot-status-text{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px}
.bot-status-text.online{color:var(--green)}
.bot-status-text.idle{color:var(--yellow)}
.bot-status-text.offline{color:var(--red)}
.pulse{display:inline-block;width:6px;height:6px;border-radius:50%;margin-right:4px;animation:pulse 2s infinite}
.pulse.online{background:var(--green)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}

/* Slide-out Panel */
.overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(4px);z-index:200;opacity:0;pointer-events:none;transition:opacity 0.3s}
.overlay.open{opacity:1;pointer-events:all}
.panel{position:fixed;top:0;right:0;bottom:0;width:420px;max-width:100vw;background:var(--panel-bg);border-left:1px solid var(--border);z-index:201;transform:translateX(100%);transition:transform 0.35s cubic-bezier(0.4,0,0.2,1);overflow-y:auto;display:flex;flex-direction:column}
.panel.open{transform:translateX(0)}
.panel-header{padding:24px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:16px;position:sticky;top:0;background:var(--panel-bg);z-index:1}
.panel-close{width:36px;height:36px;border-radius:10px;border:1px solid var(--border);background:transparent;color:var(--text);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px;transition:background 0.2s}
.panel-close:hover{background:var(--card)}
.panel-avatar{width:56px;height:56px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:28px}
.panel-info h2{font-size:18px;font-weight:700}
.panel-info p{font-size:13px;color:var(--text-dim)}
.panel-body{padding:24px;flex:1}
.panel-section{margin-bottom:24px}
.panel-section h3{font-size:12px;text-transform:uppercase;letter-spacing:1px;color:var(--text-dim);margin-bottom:12px}
.metric-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.metric{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:14px}
.metric .val{font-size:22px;font-weight:700}
.metric .mlabel{font-size:11px;color:var(--text-dim);margin-top:2px}
.activity-item{display:flex;gap:12px;padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.04)}
.activity-item:last-child{border-bottom:none}
.activity-dot{width:8px;height:8px;border-radius:50%;background:var(--blue);margin-top:5px;flex-shrink:0}
.activity-text{font-size:13px;line-height:1.5}
.activity-time{font-size:11px;color:var(--text-dim)}
.desc-text{font-size:14px;color:var(--text);line-height:1.6;background:var(--card);padding:14px;border-radius:10px;border:1px solid var(--border)}

/* Responsive */
@media(max-width:600px){
  .header-inner{flex-direction:column;align-items:flex-start}
  .stats-bar{width:100%;justify-content:space-between}
  .desk-grid{grid-template-columns:1fr 1fr}
  .panel{width:100vw}
  .stat{padding:6px 10px}
  .stat .num{font-size:15px}
}
@media(max-width:400px){
  .desk-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<header class="header">
  <div class="header-inner">
    <div class="logo-area">
      <div class="logo-icon">ðŸŽ¯</div>
      <div class="logo-text">
        <h1>Gunner Control Room</h1>
        <p>AI Workforce Dashboard</p>
      </div>
    </div>
    <div class="stats-bar">
      <div class="stat"><div class="dot green"></div><div><div class="num" id="cnt-online">0</div><div class="label">Online</div></div></div>
      <div class="stat"><div class="dot yellow"></div><div><div class="num" id="cnt-idle">0</div><div class="label">Standby</div></div></div>
      <div class="stat"><div class="dot red"></div><div><div class="num" id="cnt-offline">0</div><div class="label">Planned</div></div></div>
      <div class="stat"><div><div class="num" id="cnt-total">0</div><div class="label">Total Bots</div></div></div>
    </div>
  </div>
</header>

<div class="overlay" id="overlay" onclick="closePanel()"></div>
<div class="panel" id="panel">
  <div class="panel-header">
    <button class="panel-close" onclick="closePanel()">âœ•</button>
    <div class="panel-avatar" id="p-avatar"></div>
    <div class="panel-info"><h2 id="p-name"></h2><p id="p-engine"></p></div>
  </div>
  <div class="panel-body">
    <div class="panel-section">
      <h3>Description</h3>
      <div class="desc-text" id="p-desc"></div>
    </div>
    <div class="panel-section">
      <h3>Performance</h3>
      <div class="metric-grid" id="p-metrics"></div>
    </div>
    <div class="panel-section">
      <h3>Recent Activity</h3>
      <div id="p-activity"></div>
    </div>
  </div>
</div>

<main class="main" id="main"></main>

<script>
const engines = [
  {id:1,name:"Transcript Processing",status:"live",bots:[
    {name:"LM Assistant",icon:"ðŸ“ž",desc:"Post-call automation for Lead Managers. Processes call transcripts, updates CRM fields, and triggers follow-up workflows automatically.",status:"online",
      metrics:[{v:"1,247",l:"Calls Processed"},{v:"98.2%",l:"Accuracy"},{v:"3.2s",l:"Avg Response"},{v:"24/7",l:"Uptime"}],
      activity:[{t:"Processed transcript for lead #4821 â€” updated disposition to 'Hot Lead'",time:"2 min ago"},{t:"Auto-tagged 3 properties as investor-friendly based on call keywords",time:"18 min ago"},{t:"Synced 12 call summaries to GHL contact records",time:"1 hr ago"}]},
    {name:"AM Assistant",icon:"ðŸŽ§",desc:"Post-call automation for Acquisition Managers. Captures deal details from calls and pushes structured data to pipeline.",status:"online",
      metrics:[{v:"892",l:"Calls Processed"},{v:"97.8%",l:"Accuracy"},{v:"2.8s",l:"Avg Response"},{v:"24/7",l:"Uptime"}],
      activity:[{t:"Extracted offer details from AM call â€” $185K ARV, $120K offer",time:"5 min ago"},{t:"Flagged follow-up needed: seller wants callback Thursday",time:"32 min ago"},{t:"Updated pipeline stage for 3 deals to 'Offer Sent'",time:"2 hr ago"}]},
    {name:"Lead Summary Bot",icon:"ðŸ“‹",desc:"Auto-generates concise summaries from call transcripts. Creates structured briefs for team review.",status:"online",
      metrics:[{v:"2,103",l:"Summaries Generated"},{v:"4.8â˜…",l:"Quality Score"},{v:"< 10s",l:"Generation Time"},{v:"312",l:"This Week"}],
      activity:[{t:"Generated summary for 45-min seller call â€” flagged as motivated",time:"8 min ago"},{t:"Batch processed 6 overnight call recordings",time:"1 hr ago"},{t:"Created daily summary digest for team Slack",time:"3 hr ago"}]}
  ]},
  {id:2,name:"CRM Scanner",status:"live",bots:[
    {name:"Pipeline Signals",icon:"ðŸ“¡",desc:"Detects missed and at-risk opportunities in the CRM pipeline. Alerts team to stale deals and follow-up gaps.",status:"online",
      metrics:[{v:"47",l:"Signals Today"},{v:"12",l:"At-Risk Deals"},{v:"$2.1M",l:"Pipeline Protected"},{v:"8",l:"Saves This Week"}],
      activity:[{t:"ALERT: Deal #3291 no contact in 14 days â€” $45K potential profit at risk",time:"12 min ago"},{t:"Detected 3 leads with expired follow-up dates",time:"45 min ago"},{t:"Weekly pipeline health score: 78/100 (up from 71)",time:"6 hr ago"}]},
    {name:"Data Hygiene Bot",icon:"ðŸ§¹",desc:"Continuously cleans and validates CRM data. Fixes duplicates, standardizes formats, fills missing fields.",status:"online",
      metrics:[{v:"3,891",l:"Records Cleaned"},{v:"142",l:"Dupes Merged"},{v:"99.1%",l:"Data Quality"},{v:"0",l:"Errors Today"}],
      activity:[{t:"Merged 3 duplicate contacts â€” consolidated to single record",time:"22 min ago"},{t:"Standardized 47 phone numbers to E.164 format",time:"1 hr ago"},{t:"Filled 18 missing property addresses from public records",time:"4 hr ago"}]},
    {name:"Process Compliance Bot",icon:"âš–ï¸",desc:"Enforces business rules and SOP compliance across the CRM. Flags violations and auto-corrects where possible.",status:"online",
      metrics:[{v:"23",l:"Violations Today"},{v:"94%",l:"Compliance Rate"},{v:"156",l:"Auto-Corrected"},{v:"7",l:"Escalated"}],
      activity:[{t:"Flagged: Lead assigned but no call within 5-min SLA",time:"15 min ago"},{t:"Auto-corrected 4 deals missing required disposition codes",time:"1 hr ago"},{t:"Compliance report generated â€” emailed to management",time:"5 hr ago"}]}
  ]},
  {id:3,name:"Nurture & Timing",status:"planned",bots:[
    {name:"Follow Up Bot",icon:"ðŸ”„",desc:"Intelligent nurture sequences that adapt timing and messaging based on lead behavior and engagement signals.",status:"idle",
      metrics:[{v:"â€”",l:"Sequences Active"},{v:"â€”",l:"Messages Sent"},{v:"â€”",l:"Response Rate"},{v:"Q2",l:"Target Launch"}],
      activity:[{t:"Engine spec finalized â€” awaiting development sprint",time:"2 days ago"},{t:"Nurture template library drafted (12 sequences)",time:"5 days ago"}]},
    {name:"After-Hours Bot",icon:"ðŸŒ™",desc:"Engages inbound leads during off-hours with intelligent responses. Qualifies and schedules callbacks for the team.",status:"idle",
      metrics:[{v:"â€”",l:"Leads Engaged"},{v:"â€”",l:"After-Hours Calls"},{v:"â€”",l:"Conversion Rate"},{v:"Q2",l:"Target Launch"}],
      activity:[{t:"Call flow designed for after-hours engagement",time:"1 week ago"},{t:"Integration plan with CallRail completed",time:"2 weeks ago"}]},
    {name:"Seller Re-engagement Bot",icon:"ðŸ”",desc:"Re-engages declined sellers with timed follow-ups. Monitors market changes that might shift seller motivation.",status:"idle",
      metrics:[{v:"â€”",l:"Sellers Tracked"},{v:"â€”",l:"Re-engaged"},{v:"â€”",l:"Win-Back Rate"},{v:"Q2",l:"Target Launch"}],
      activity:[{t:"Re-engagement cadence templates created",time:"1 week ago"}]},
    {name:"Appointment Bot",icon:"ðŸ“…",desc:"Handles scheduling, confirmations, and no-show follow-ups. Integrates with team calendars for real-time availability.",status:"idle",
      metrics:[{v:"â€”",l:"Appointments Set"},{v:"â€”",l:"Show Rate"},{v:"â€”",l:"No-Show Recovery"},{v:"Q2",l:"Target Launch"}],
      activity:[{t:"Calendar integration spec completed",time:"3 days ago"}]}
  ]},
  {id:4,name:"Data & Reporting",status:"planned",bots:[
    {name:"KPI Entry Bot",icon:"ðŸ“Š",desc:"Auto-populates KPI spreadsheets from CRM, dialer, and SMS platform data. Eliminates manual data entry.",status:"idle",
      metrics:[{v:"â€”",l:"Entries Made"},{v:"â€”",l:"Sources Connected"},{v:"â€”",l:"Time Saved/Week"},{v:"Q2",l:"Target Launch"}],
      activity:[{t:"API connections tested for BatchDialer and BatchLeads",time:"3 days ago"},{t:"KPI template mapped to data sources",time:"1 week ago"}]},
    {name:"Report Generator",icon:"ðŸ“ˆ",desc:"Generates daily, weekly, and monthly performance reports with charts and insights. Auto-distributes to stakeholders.",status:"idle",
      metrics:[{v:"â€”",l:"Reports Generated"},{v:"â€”",l:"Templates"},{v:"â€”",l:"Recipients"},{v:"Q3",l:"Target Launch"}],
      activity:[{t:"Report template designs approved",time:"1 week ago"}]},
    {name:"Team Chat Digest",icon:"ðŸ’¬",desc:"Summarizes team chat channels into daily digests. Highlights decisions, action items, and key discussions.",status:"idle",
      metrics:[{v:"â€”",l:"Digests Created"},{v:"â€”",l:"Messages Processed"},{v:"â€”",l:"Action Items Found"},{v:"Q3",l:"Target Launch"}],
      activity:[{t:"Digest format and delivery schedule planned",time:"2 weeks ago"}]}
  ]},
  {id:5,name:"Scheduling",status:"planned",bots:[
    {name:"Scheduling Coordinator",icon:"ðŸ—“ï¸",desc:"Manages AM availability, prevents double-booking, and optimizes appointment distribution across the team.",status:"idle",
      metrics:[{v:"â€”",l:"Slots Managed"},{v:"â€”",l:"Conflicts Resolved"},{v:"â€”",l:"Utilization Rate"},{v:"Q3",l:"Target Launch"}],
      activity:[{t:"Scheduling logic requirements documented",time:"2 weeks ago"}]},
    {name:"Callback Capture Bot",icon:"ðŸ“²",desc:"AI listens to callback requests in voicemails and missed calls. Auto-schedules return calls for the team.",status:"idle",
      metrics:[{v:"â€”",l:"Callbacks Captured"},{v:"â€”",l:"Auto-Scheduled"},{v:"â€”",l:"Response Time"},{v:"Q3",l:"Target Launch"}],
      activity:[{t:"CallRail webhook integration planned",time:"2 weeks ago"}]}
  ]},
  {id:6,name:"Documents & Deals",status:"planned",bots:[
    {name:"Contract Bot",icon:"ðŸ“",desc:"Generates, sends, and tracks contracts. Auto-populates from deal data and monitors signature status.",status:"idle",
      metrics:[{v:"â€”",l:"Contracts Sent"},{v:"â€”",l:"Signed"},{v:"â€”",l:"Avg Sign Time"},{v:"Q3",l:"Target Launch"}],
      activity:[{t:"Contract template library being compiled",time:"2 weeks ago"}]},
    {name:"Deal Packaging Bot",icon:"ðŸ“¦",desc:"Auto-populates deal packages with comps, photos, repair estimates, and financials for buyer distribution.",status:"idle",
      metrics:[{v:"â€”",l:"Packages Created"},{v:"â€”",l:"Avg Build Time"},{v:"â€”",l:"Data Sources"},{v:"Q3",l:"Target Launch"}],
      activity:[{t:"Deal package template designed",time:"3 weeks ago"}]},
    {name:"Deal Distribution Bot",icon:"ðŸš€",desc:"Pushes completed deal packages to buyer list. Tracks interest, manages offers, and reports engagement.",status:"idle",
      metrics:[{v:"â€”",l:"Deals Distributed"},{v:"â€”",l:"Buyer Reach"},{v:"â€”",l:"Avg Offers/Deal"},{v:"Q3",l:"Target Launch"}],
      activity:[{t:"Buyer list segmentation strategy planned",time:"3 weeks ago"}]}
  ]},
  {id:0,name:"Standalone Bots",status:"mixed",bots:[
    {name:"PPL Refund Bot",icon:"ðŸ’°",desc:"Automatically files lead disputes on PPL platforms (Leadzolo, PropertyLeads, MotivatedSellers). Saves hours of manual work weekly.",status:"online",
      metrics:[{v:"89",l:"Disputes Filed"},{v:"$12,400",l:"Refunds Won"},{v:"78%",l:"Win Rate"},{v:"3",l:"Platforms"}],
      activity:[{t:"Filed dispute on PropertyLeads â€” wrong number, lead #8821",time:"1 hr ago"},{t:"Won $150 refund from Leadzolo â€” duplicate lead confirmed",time:"4 hr ago"},{t:"Weekly dispute report: 12 filed, 9 won, $1,840 recovered",time:"1 day ago"}]},
    {name:"Market Watch Bot",icon:"ðŸ”",desc:"Tracks market trends, comparable sales, and pricing shifts. Provides daily market intelligence for acquisition decisions.",status:"idle",
      metrics:[{v:"â€”",l:"Markets Tracked"},{v:"â€”",l:"Comps Analyzed"},{v:"â€”",l:"Alerts Sent"},{v:"Q2",l:"Target Launch"}],
      activity:[{t:"Data source evaluation complete â€” Zillow, Redfin, MLS APIs",time:"1 week ago"}]},
    {name:"MLS Monitor Bot",icon:"ðŸ ",desc:"Monitors MLS for new listings matching investment criteria. Sends instant alerts when target properties hit the market.",status:"idle",
      metrics:[{v:"â€”",l:"Listings Monitored"},{v:"â€”",l:"Alerts Sent"},{v:"â€”",l:"Criteria Sets"},{v:"Q2",l:"Target Launch"}],
      activity:[{t:"MLS API access being negotiated",time:"2 weeks ago"}]},
    {name:"Voicemail Bot",icon:"ðŸŽ¤",desc:"Processes CallRail voicemail transcriptions. Categorizes, prioritizes, and routes voicemails to the right team member.",status:"idle",
      metrics:[{v:"â€”",l:"Voicemails Processed"},{v:"â€”",l:"Auto-Routed"},{v:"â€”",l:"Priority Flags"},{v:"Q2",l:"Target Launch"}],
      activity:[{t:"CallRail API integration tested successfully",time:"5 days ago"}]}
  ]}
];

// Render
const main=document.getElementById('main');
let totalOnline=0,totalIdle=0,totalOffline=0;

engines.forEach(eng=>{
  const section=document.createElement('div');
  section.className='engine';
  const statusClass=eng.status==='live'?'live':eng.status==='mixed'?'built':'planned';
  const statusLabel=eng.status==='live'?'LIVE':eng.status==='mixed'?'MIXED':'PLANNED';
  section.innerHTML=`<div class="engine-header">
    <span class="engine-badge ${statusClass}">${statusLabel}</span>
    <span class="engine-title">${eng.id?'Engine '+eng.id+' â€”':''} ${eng.name}</span>
    <span class="engine-subtitle">${eng.bots.length} bot${eng.bots.length>1?'s':''}</span>
  </div><div class="desk-grid" id="grid-${eng.id}"></div>`;
  main.appendChild(section);
  const grid=document.getElementById('grid-'+eng.id);

  eng.bots.forEach((bot,i)=>{
    if(bot.status==='online')totalOnline++;
    else if(bot.status==='idle')totalIdle++;
    else totalOffline++;

    const card=document.createElement('div');
    card.className=`desk status-${bot.status}`;
    const lastAction=bot.activity&&bot.activity[0]?bot.activity[0].time:'â€”';
    card.innerHTML=`<div class="desk-top">
      <div class="bot-avatar ${bot.status}">${bot.icon}<div class="status-dot ${bot.status}"></div></div>
      <div class="desk-actions">${lastAction}</div>
    </div>
    <div class="bot-name">${bot.name}</div>
    <div class="bot-desc">${bot.desc.substring(0,60)}â€¦</div>
    <div class="bot-meta">
      <span class="bot-status-text ${bot.status}">${bot.status==='online'?'<span class="pulse online"></span>Online':bot.status==='idle'?'Standby':'Offline'}</span>
    </div>`;
    card.onclick=()=>openPanel(bot,eng);
    grid.appendChild(card);
  });
});

document.getElementById('cnt-online').textContent=totalOnline;
document.getElementById('cnt-idle').textContent=totalIdle;
document.getElementById('cnt-offline').textContent=totalOffline;
document.getElementById('cnt-total').textContent=totalOnline+totalIdle+totalOffline;

function openPanel(bot,eng){
  document.getElementById('p-avatar').className='panel-avatar bot-avatar '+bot.status;
  document.getElementById('p-avatar').innerHTML=bot.icon;
  document.getElementById('p-name').textContent=bot.name;
  document.getElementById('p-engine').textContent=(eng.id?'Engine '+eng.id+' â€” ':'')+eng.name;
  document.getElementById('p-desc').textContent=bot.desc;

  const mg=document.getElementById('p-metrics');
  mg.innerHTML='';
  (bot.metrics||[]).forEach(m=>{
    mg.innerHTML+=`<div class="metric"><div class="val">${m.v}</div><div class="mlabel">${m.l}</div></div>`;
  });

  const ag=document.getElementById('p-activity');
  ag.innerHTML='';
  (bot.activity||[]).forEach(a=>{
    ag.innerHTML+=`<div class="activity-item"><div class="activity-dot"></div><div><div class="activity-text">${a.t}</div><div class="activity-time">${a.time}</div></div></div>`;
  });

  document.getElementById('overlay').classList.add('open');
  document.getElementById('panel').classList.add('open');
}

function closePanel(){
  document.getElementById('overlay').classList.remove('open');
  document.getElementById('panel').classList.remove('open');
}

document.addEventListener('keydown',e=>{if(e.key==='Escape')closePanel()});
</script>
</body>
</html>

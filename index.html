<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gunner Control Room</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0e17;--card:#131a2b;--card-hover:#1a2340;--border:#1e2a45;--text:#e2e8f0;--text-dim:#64748b;--green:#22c55e;--yellow:#eab308;--red:#ef4444;--blue:#3b82f6;--purple:#a855f7;--accent:#3b82f6;--panel-bg:#0f1525}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;top:0;left:0;right:0;bottom:0;background:radial-gradient(ellipse at 20% 50%,rgba(59,130,246,0.08) 0%,transparent 50%),radial-gradient(ellipse at 80% 20%,rgba(168,85,247,0.06) 0%,transparent 50%),radial-gradient(ellipse at 50% 80%,rgba(34,197,94,0.05) 0%,transparent 50%);pointer-events:none;z-index:0}

.header{position:sticky;top:0;z-index:100;background:rgba(10,14,23,0.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:16px 24px}
.header-inner{max-width:1400px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px}
.logo-area{display:flex;align-items:center;gap:14px}
.logo-icon{width:44px;height:44px;background:linear-gradient(135deg,var(--blue),var(--purple));border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;box-shadow:0 0 20px rgba(59,130,246,0.3)}
.logo-text h1{font-size:22px;font-weight:700;background:linear-gradient(135deg,#e2e8f0,#94a3b8);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.logo-text p{font-size:12px;color:var(--text-dim);letter-spacing:1px;text-transform:uppercase}
.header-right{display:flex;align-items:center;gap:16px;flex-wrap:wrap}
.connection-badge{display:flex;align-items:center;gap:6px;padding:6px 14px;background:var(--card);border:1px solid var(--border);border-radius:8px;font-size:12px;font-weight:600;transition:all 0.3s}
.connection-badge.connected{border-color:rgba(34,197,94,0.3);color:var(--green)}
.connection-badge.disconnected{border-color:rgba(239,68,68,0.3);color:var(--red)}
.stats-bar{display:flex;gap:20px;flex-wrap:wrap}
.stat{display:flex;align-items:center;gap:8px;padding:8px 16px;background:var(--card);border:1px solid var(--border);border-radius:10px}
.stat .dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.stat .dot.green{background:var(--green);box-shadow:0 0 8px var(--green)}
.stat .dot.yellow{background:var(--yellow);box-shadow:0 0 8px var(--yellow)}
.stat .dot.red{background:var(--red);box-shadow:0 0 8px var(--red)}
.stat .num{font-size:18px;font-weight:700}
.stat .label{font-size:11px;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.5px}

.main{max-width:1400px;margin:0 auto;padding:24px;position:relative;z-index:1}

.engine{margin-bottom:32px}
.engine-header{display:flex;align-items:center;gap:12px;margin-bottom:16px;padding-bottom:8px;border-bottom:1px solid var(--border)}
.engine-badge{padding:4px 12px;border-radius:6px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px}
.engine-badge.live{background:rgba(34,197,94,0.15);color:var(--green);border:1px solid rgba(34,197,94,0.3)}
.engine-badge.built{background:rgba(59,130,246,0.15);color:var(--blue);border:1px solid rgba(59,130,246,0.3)}
.engine-badge.planned{background:rgba(234,179,8,0.15);color:var(--yellow);border:1px solid rgba(234,179,8,0.3)}
.engine-badge.online{background:rgba(34,197,94,0.15);color:var(--green);border:1px solid rgba(34,197,94,0.3)}
.engine-badge.idle{background:rgba(234,179,8,0.15);color:var(--yellow);border:1px solid rgba(234,179,8,0.3)}
.engine-badge.offline{background:rgba(239,68,68,0.15);color:var(--red);border:1px solid rgba(239,68,68,0.3)}
.engine-title{font-size:16px;font-weight:600;color:var(--text)}
.engine-subtitle{font-size:13px;color:var(--text-dim)}

.desk-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}

.desk{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:20px;cursor:pointer;transition:all 0.25s ease;position:relative;overflow:hidden}
.desk:hover{background:var(--card-hover);border-color:rgba(59,130,246,0.3);transform:translateY(-2px);box-shadow:0 8px 30px rgba(0,0,0,0.3)}
.desk::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;border-radius:14px 14px 0 0;opacity:0;transition:opacity 0.25s}
.desk:hover::before{opacity:1}
.desk.status-online::before{background:linear-gradient(90deg,var(--green),var(--blue))}
.desk.status-idle::before{background:linear-gradient(90deg,var(--yellow),#f97316)}
.desk.status-standby::before{background:linear-gradient(90deg,var(--yellow),#f97316)}
.desk.status-dry-run::before{background:linear-gradient(90deg,#f97316,#f59e0b)}
.desk.status-offline::before{background:linear-gradient(90deg,var(--red),#dc2626)}
.engine-badge.dryrun{background:linear-gradient(90deg,#f97316,#f59e0b);color:#000}
.desk-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:14px}
.bot-avatar{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;position:relative}
.bot-avatar.online{background:rgba(34,197,94,0.12);border:1px solid rgba(34,197,94,0.25)}
.bot-avatar.idle{background:rgba(234,179,8,0.12);border:1px solid rgba(234,179,8,0.25)}
.bot-avatar.offline{background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.2)}
.status-dot{position:absolute;bottom:-2px;right:-2px;width:14px;height:14px;border-radius:50%;border:3px solid var(--card)}
.status-dot.online{background:var(--green);box-shadow:0 0 6px var(--green)}
.status-dot.idle{background:var(--yellow);box-shadow:0 0 6px var(--yellow)}
.status-dot.offline{background:var(--red);box-shadow:0 0 6px var(--red)}
.desk-actions{font-size:11px;color:var(--text-dim);background:rgba(255,255,255,0.05);padding:3px 8px;border-radius:6px}
.bot-name{font-size:14px;font-weight:600;margin-bottom:4px}
.bot-desc{font-size:12px;color:var(--text-dim);line-height:1.4}
.bot-meta{display:flex;align-items:center;gap:8px;margin-top:12px;padding-top:10px;border-top:1px solid rgba(255,255,255,0.05)}
.bot-status-text{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px}
.bot-status-text.online{color:var(--green)}
.bot-status-text.idle{color:var(--yellow)}
.bot-status-text.offline{color:var(--red)}
.pulse{display:inline-block;width:6px;height:6px;border-radius:50%;margin-right:4px;animation:pulse 2s infinite}
.pulse.online{background:var(--green)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}

.overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(4px);z-index:200;opacity:0;pointer-events:none;transition:opacity 0.3s}
.overlay.open{opacity:1;pointer-events:all}
.panel{position:fixed;top:0;right:0;bottom:0;width:420px;max-width:100vw;background:var(--panel-bg);border-left:1px solid var(--border);z-index:201;transform:translateX(100%);transition:transform 0.35s cubic-bezier(0.4,0,0.2,1);overflow-y:auto;display:flex;flex-direction:column}
.panel.open{transform:translateX(0)}
.panel-header{padding:24px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:16px;position:sticky;top:0;background:var(--panel-bg);z-index:1}
.panel-close{width:36px;height:36px;border-radius:10px;border:1px solid var(--border);background:transparent;color:var(--text);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px;transition:background 0.2s}
.panel-close:hover{background:var(--card)}
.panel-avatar{width:56px;height:56px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:28px}
.panel-info h2{font-size:18px;font-weight:700}
.panel-info p{font-size:13px;color:var(--text-dim)}
.panel-body{padding:24px;flex:1}
.panel-section{margin-bottom:24px}
.panel-section h3{font-size:12px;text-transform:uppercase;letter-spacing:1px;color:var(--text-dim);margin-bottom:12px}
.metric-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.metric{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:14px}
.metric .val{font-size:22px;font-weight:700}
.metric .mlabel{font-size:11px;color:var(--text-dim);margin-top:2px}
.activity-item{display:flex;gap:12px;padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.04)}
.activity-item:last-child{border-bottom:none}
.activity-dot{width:8px;height:8px;border-radius:50%;background:var(--blue);margin-top:5px;flex-shrink:0}
.activity-text{font-size:13px;line-height:1.5}
.activity-time{font-size:11px;color:var(--text-dim)}
.desc-text{font-size:14px;color:var(--text);line-height:1.6;background:var(--card);padding:14px;border-radius:10px;border:1px solid var(--border)}
.dry-run-badge{display:inline-block;padding:3px 10px;border-radius:6px;font-size:11px;font-weight:700;background:rgba(240,136,62,0.2);color:#f0883e;border:1px solid rgba(240,136,62,0.3)}
.last-refresh{font-size:11px;color:var(--text-dim)}

/* Dispo Pipeline Styles */
.pipeline-section{margin-bottom:32px;background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px;overflow-x:auto}
.pipeline-header{display:flex;align-items:center;gap:12px;margin-bottom:20px}
.pipeline-header h2{font-size:18px;font-weight:700;background:linear-gradient(135deg,var(--green),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.pipeline-header .pipeline-badge{padding:4px 10px;border-radius:6px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;background:rgba(34,197,94,0.15);color:var(--green);border:1px solid rgba(34,197,94,0.3)}
.pipeline-flow{display:flex;align-items:flex-start;gap:8px;min-width:max-content;padding:10px 0}
.pipeline-stage{display:flex;flex-direction:column;align-items:center;gap:6px}
.stage-pill{padding:10px 16px;border-radius:10px;background:var(--card-hover);border:1px solid var(--border);font-size:12px;font-weight:600;text-align:center;min-width:100px;transition:all 0.2s}
.stage-pill.start-marketing{background:rgba(34,197,94,0.15);border-color:rgba(34,197,94,0.4);color:var(--green);box-shadow:0 0 15px rgba(34,197,94,0.2)}
.stage-count{font-size:10px;color:var(--text-dim);background:rgba(255,255,255,0.05);padding:2px 8px;border-radius:4px}
.pipeline-arrow{color:var(--text-dim);font-size:18px;display:flex;align-items:center;padding-top:8px}
.pipeline-split{display:flex;flex-direction:column;gap:12px;position:relative;padding-left:20px}
.pipeline-split::before{content:'';position:absolute;left:0;top:20px;bottom:20px;width:2px;background:var(--border)}
.split-branch{display:flex;align-items:center;gap:8px}
.split-branch::before{content:'';width:16px;height:2px;background:var(--border)}
.branch-label{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;padding:6px 12px;border-radius:8px;min-width:100px;text-align:center}
.branch-label.hunts{background:rgba(59,130,246,0.15);color:var(--blue);border:1px solid rgba(59,130,246,0.3)}
.branch-label.lists{background:rgba(168,85,247,0.15);color:var(--purple);border:1px solid rgba(168,85,247,0.3)}
.branch-channels{display:flex;flex-wrap:wrap;gap:6px;margin-left:8px}
.channel-tag{font-size:10px;padding:4px 8px;border-radius:4px;background:rgba(255,255,255,0.05);color:var(--text-dim);border:1px solid rgba(255,255,255,0.08)}
.schedule-bar{margin-top:20px;padding-top:16px;border-top:1px solid var(--border)}
.schedule-title{font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--text-dim);margin-bottom:10px}
.schedule-days{display:flex;gap:4px;border-radius:8px;overflow:hidden}
.schedule-day{flex:1;padding:10px 12px;text-align:center;font-size:11px;font-weight:600;text-transform:uppercase;transition:all 0.3s}
.schedule-day.exclusive{background:rgba(59,130,246,0.2);color:var(--blue)}
.schedule-day.public{background:rgba(34,197,94,0.2);color:var(--green)}
.schedule-day.inbound{background:rgba(234,179,8,0.2);color:var(--yellow)}
.schedule-day.today{box-shadow:inset 0 0 0 2px currentColor;animation:today-pulse 2s infinite}
@keyframes today-pulse{0%,100%{opacity:1}50%{opacity:0.7}}
.schedule-legend{display:flex;gap:16px;margin-top:10px;flex-wrap:wrap}
.legend-item{display:flex;align-items:center;gap:6px;font-size:10px;color:var(--text-dim)}
.legend-dot{width:8px;height:8px;border-radius:2px}
.legend-dot.blue{background:var(--blue)}
.legend-dot.green{background:var(--green)}
.legend-dot.yellow{background:var(--yellow)}

@media(max-width:600px){
  .header-inner{flex-direction:column;align-items:flex-start}
  .stats-bar{width:100%;justify-content:space-between}
  .desk-grid{grid-template-columns:1fr 1fr}
  .panel{width:100vw}
  .stat{padding:6px 10px}
  .stat .num{font-size:15px}
}
@media(max-width:400px){
  .desk-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<header class="header">
  <div class="header-inner">
    <div class="logo-area">
      <div class="logo-icon">ğŸ¯</div>
      <div class="logo-text">
        <h1>Gunner Control Room</h1>
        <p>AI Workforce Dashboard</p>
      </div>
    </div>
    <div class="header-right">
      <div class="connection-badge disconnected" id="conn-badge">ğŸŸ¡ Loadingâ€¦</div>
      <span class="last-refresh" id="last-refresh"></span>
      <div class="stats-bar">
        <div class="stat"><div class="dot green"></div><div><div class="num" id="cnt-online">0</div><div class="label">Approved</div></div></div>
        <div class="stat"><div class="dot yellow"></div><div><div class="num" id="cnt-idle">0</div><div class="label">Ready for Review</div></div></div>
        <div class="stat"><div class="dot red"></div><div><div class="num" id="cnt-offline">0</div><div class="label">Building / Testing</div></div></div>
        <div class="stat"><div><div class="num" id="cnt-total">0</div><div class="label">Total Bots</div></div></div>
      </div>
    </div>
  </div>
</header>

<div class="overlay" id="overlay" onclick="closePanel()"></div>
<div class="panel" id="panel">
  <div class="panel-header">
    <button class="panel-close" onclick="closePanel()">âœ•</button>
    <div class="panel-avatar" id="p-avatar"></div>
    <div class="panel-info"><h2 id="p-name"></h2><p id="p-engine"></p></div>
  </div>
  <div class="panel-body">
    <div class="panel-section">
      <h3>Description</h3>
      <div class="desc-text" id="p-desc"></div>
    </div>
    <div class="panel-section">
      <h3>Live Metrics</h3>
      <div class="metric-grid" id="p-metrics"></div>
    </div>
    <div class="panel-section">
      <h3>Recent Activity <span class="dry-run-badge" id="p-dryrun" style="display:none">DRY RUN</span></h3>
      <div id="p-activity"></div>
    </div>
  </div>
</div>

<main class="main">
  <!-- New Seller Lead Flow -->
  <section class="pipeline-section" id="seller-lead-flow">
    <div class="pipeline-header">
      <h2>ğŸ“ New Seller Lead Flow</h2>
      <span class="pipeline-badge">LIVE</span>
    </div>
    <div class="pipeline-flow">
      <div class="pipeline-stage">
        <div class="stage-pill" style="background:rgba(168,85,247,0.15);border-color:rgba(168,85,247,0.4);color:var(--purple)">ğŸ“¥ Lead Enters CRM</div>
        <div class="stage-count">PPL Â· Dialer Â· SMS Â· Forms</div>
      </div>
      <div class="pipeline-arrow">â†’</div>
      <div class="pipeline-stage">
        <div class="stage-pill">ğŸ§¹ Data Hygiene</div>
        <div class="stage-count">Clean Â· Enrich Â· Verify</div>
      </div>
      <div class="pipeline-arrow">â†’</div>
      <div class="pipeline-stage">
        <div class="stage-pill">ğŸ§  Lead IQ</div>
        <div class="stage-count">Score Â· Tag Â· Assign Â· Route</div>
      </div>
      <div class="pipeline-arrow">â†’</div>
      <div class="pipeline-split">
        <div class="split-branch">
          <div class="branch-label hunts">ğŸ”¥ HOT</div>
          <div class="branch-channels">
            <span class="channel-tag">Move to Hot Leads</span>
            <span class="channel-tag">Urgent task</span>
            <span class="channel-tag">Email alert</span>
          </div>
        </div>
        <div class="split-branch">
          <div class="branch-label lists">ğŸŒ¡ï¸ WARM</div>
          <div class="branch-channels">
            <span class="channel-tag">Move to Warm Leads</span>
            <span class="channel-tag">Standard task</span>
            <span class="channel-tag">Email alert</span>
          </div>
        </div>
      </div>
      <div class="pipeline-arrow">â†’</div>
      <div class="pipeline-stage">
        <div class="stage-pill start-marketing">âš¡ New Lead Responder</div>
        <div class="stage-count">Immediate SMS</div>
      </div>
      <div class="pipeline-arrow">â†’</div>
      <div class="pipeline-stage">
        <div class="stage-pill">ğŸ“± Team Member Calls</div>
        <div class="stage-count">Task + notification</div>
      </div>
      <div class="pipeline-arrow">â†’</div>
      <div class="pipeline-split">
        <div class="split-branch">
          <div class="branch-label" style="background:rgba(34,197,94,0.15);color:var(--green);border:1px solid rgba(34,197,94,0.3)">âœ… Connected</div>
          <div class="branch-channels">
            <span class="channel-tag">Qualification</span>
            <span class="channel-tag">â†’ Appointment</span>
          </div>
        </div>
        <div class="split-branch">
          <div class="branch-label" style="background:rgba(234,179,8,0.15);color:var(--yellow);border:1px solid rgba(234,179,8,0.3)">ğŸ“µ No Answer</div>
          <div class="branch-channels">
            <span class="channel-tag">New Lead Drip activates</span>
            <span class="channel-tag">104-day SMS + email</span>
          </div>
        </div>
        <div class="split-branch">
          <div class="branch-label" style="background:rgba(239,68,68,0.15);color:var(--red);border:1px solid rgba(239,68,68,0.3)">ğŸš« DNC</div>
          <div class="branch-channels">
            <span class="channel-tag">Flag + stop all</span>
          </div>
        </div>
      </div>
    </div>
    <div class="schedule-bar">
      <div class="schedule-title">Engine Chain (Sequential)</div>
      <div style="display:flex;gap:4px;align-items:center;flex-wrap:wrap;padding:8px 0">
        <span style="padding:8px 14px;border-radius:8px;background:rgba(34,197,94,0.2);color:var(--green);font-size:12px;font-weight:600">1. Data Hygiene</span>
        <span style="color:var(--text-dim)">â†’</span>
        <span style="padding:8px 14px;border-radius:8px;background:rgba(59,130,246,0.2);color:var(--blue);font-size:12px;font-weight:600">2. Lead IQ + Stage Move</span>
        <span style="color:var(--text-dim)">â†’</span>
        <span style="padding:8px 14px;border-radius:8px;background:rgba(168,85,247,0.2);color:var(--purple);font-size:12px;font-weight:600">3. New Lead Responder SMS</span>
        <span style="color:var(--text-dim)">â†’</span>
        <span style="padding:8px 14px;border-radius:8px;background:rgba(234,179,8,0.2);color:var(--yellow);font-size:12px;font-weight:600">4. New Lead Drip (if no response)</span>
      </div>
      <div class="schedule-legend">
        <div class="legend-item"><div class="legend-dot green"></div>Triggers on: Sales Process â†’ New Lead stage (sellers only)</div>
        <div class="legend-item"><div class="legend-dot blue"></div>Buyers, partners, other contacts: untouched</div>
      </div>
    </div>
  </section>

  <!-- Follow-Up Bot Flow -->
  <section class="pipeline-section" id="followup-flow">
    <div class="pipeline-header">
      <h2>ğŸ”„ Follow-Up Bot V2</h2>
      <span class="pipeline-badge" style="background:rgba(240,136,62,0.15);color:#f0883e;border:1px solid rgba(240,136,62,0.3)">BUILT â€” DRY RUN</span>
      <span style="font-size:12px;color:var(--text-dim);margin-left:auto">$199/mo bundle â€” 4 agents Â· 35 msgs/day cap</span>
    </div>
    <div class="pipeline-flow">
      <div class="pipeline-stage">
        <div class="stage-pill" style="background:rgba(168,85,247,0.15);border-color:rgba(168,85,247,0.4);color:var(--purple)">ğŸ“¥ Team Moves to Follow-Up</div>
        <div class="stage-count">From Sales Process</div>
      </div>
      <div class="pipeline-arrow">â†’</div>
      <div class="pipeline-stage">
        <div class="stage-pill">ğŸšª Entry Router</div>
        <div class="stage-count">Tag Â· Remove Drip Â· Create Opp</div>
      </div>
      <div class="pipeline-arrow">â†’</div>
      <div class="pipeline-stage">
        <div class="stage-pill">ğŸ“‹ Organizer</div>
        <div class="stage-count">Score motivation Â· Delta analysis</div>
      </div>
      <div class="pipeline-arrow">â†’</div>
      <div class="pipeline-stage">
        <div class="stage-pill">ğŸ’¬ Messenger</div>
        <div class="stage-count">4 Month + 12 Month only</div>
      </div>
      <div class="pipeline-arrow">â†’</div>
      <div class="pipeline-split">
        <div class="split-branch">
          <div class="branch-label" style="background:rgba(34,197,94,0.15);color:var(--green);border:1px solid rgba(34,197,94,0.3)">ğŸ”¥ Re-engaged (7+)</div>
          <div class="branch-channels">
            <span class="channel-tag">â†’ Closer (stub)</span>
            <span class="channel-tag">â†’ Back to Sales Process</span>
          </div>
        </div>
        <div class="split-branch">
          <div class="branch-label" style="background:rgba(59,130,246,0.15);color:var(--blue);border:1px solid rgba(59,130,246,0.3)">ğŸŒ¡ï¸ Warming Up (4-6)</div>
          <div class="branch-channels">
            <span class="channel-tag">0.6x timing multiplier</span>
            <span class="channel-tag">More frequent touches</span>
          </div>
        </div>
        <div class="split-branch">
          <div class="branch-label" style="background:rgba(234,179,8,0.15);color:var(--yellow);border:1px solid rgba(234,179,8,0.3)">â„ï¸ Still Cold (0-3)</div>
          <div class="branch-channels">
            <span class="channel-tag">Standard intervals</span>
            <span class="channel-tag">Light touches</span>
          </div>
        </div>
        <div class="split-branch">
          <div class="branch-label" style="background:rgba(239,68,68,0.15);color:var(--red);border:1px solid rgba(239,68,68,0.3)">ğŸš« Dead (strict)</div>
          <div class="branch-channels">
            <span class="channel-tag">Legal threats only</span>
            <span class="channel-tag">Confirmed sold</span>
            <span class="channel-tag">Unviable property</span>
          </div>
        </div>
      </div>
    </div>
    <div class="schedule-bar">
      <div class="schedule-title">Pipeline Split</div>
      <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;padding:8px 0">
        <span style="padding:8px 14px;border-radius:8px;background:rgba(59,130,246,0.2);color:var(--blue);font-size:12px;font-weight:600">1 Month â†’ MANUAL (team in Sales Process)</span>
        <span style="padding:8px 14px;border-radius:8px;background:rgba(168,85,247,0.2);color:var(--purple);font-size:12px;font-weight:600">4 Month â†’ BOT (Follow Up pipeline)</span>
        <span style="padding:8px 14px;border-radius:8px;background:rgba(168,85,247,0.2);color:var(--purple);font-size:12px;font-weight:600">12 Month â†’ BOT (Follow Up pipeline)</span>
      </div>
      <div class="schedule-legend">
        <div class="legend-item"><div class="legend-dot blue"></div>1 Month stays in Sales Process â€” team handles directly</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--purple)"></div>4 Month + 12 Month in Follow Up pipeline â€” bots manage</div>
        <div class="legend-item"><div class="legend-dot" style="background:#f0883e"></div>Disposition Advisor â€” freshly built, building & testing</div>
      </div>
    </div>
  </section>

  <!-- Dispo Pipeline Section -->
  <section class="pipeline-section" id="dispo-pipeline">
    <div class="pipeline-header">
      <h2>ğŸš€ Dispo Pipeline</h2>
      <span class="pipeline-badge">LIVE</span>
    </div>
    <div class="pipeline-flow">
      <div class="pipeline-stage">
        <div class="stage-pill">ğŸ“‹ Expectations Set</div>
        <div class="stage-count" id="stage-expectations">â€” deals</div>
      </div>
      <div class="pipeline-arrow">â†’</div>
      <div class="pipeline-stage">
        <div class="stage-pill">ğŸ“¸ Photos</div>
        <div class="stage-count" id="stage-photos">â€” deals</div>
      </div>
      <div class="pipeline-arrow">â†’</div>
      <div class="pipeline-stage">
        <div class="stage-pill">ğŸ“Š Details & Numbers</div>
        <div class="stage-count" id="stage-details">â€” deals</div>
      </div>
      <div class="pipeline-arrow">â†’</div>
      <div class="pipeline-stage">
        <div class="stage-pill">ğŸŒ Property Website</div>
        <div class="stage-count" id="stage-website">â€” deals</div>
      </div>
      <div class="pipeline-arrow">â†’</div>
      <div class="pipeline-stage">
        <div class="stage-pill start-marketing">ğŸš¦ START MARKETING</div>
        <div class="stage-count" id="stage-marketing">â€” ready</div>
      </div>
      <div class="pipeline-arrow">â†’</div>
      <div class="pipeline-split">
        <div class="split-branch">
          <div class="branch-label hunts">ğŸ¯ Buyer Hunts</div>
          <div class="branch-channels">
            <span class="channel-tag">InvestorLift</span>
            <span class="channel-tag">Mevlo</span>
            <span class="channel-tag">Zillow</span>
            <span class="channel-tag">MLS</span>
            <span class="channel-tag">Facebook</span>
            <span class="channel-tag">Mass Campaigns</span>
          </div>
        </div>
        <div class="split-branch">
          <div class="branch-label lists">ğŸ“‹ Buyer Lists</div>
          <div class="branch-channels">
            <span class="channel-tag">Privy</span>
            <span class="channel-tag">OpenDeal</span>
            <span class="channel-tag">JV Partners</span>
          </div>
        </div>
      </div>
    </div>
    <div class="schedule-bar">
      <div class="schedule-title">Weekly Dispo Schedule</div>
      <div class="schedule-days" id="schedule-days">
        <div class="schedule-day exclusive" data-day="1">Mon<br><small>Exclusive</small></div>
        <div class="schedule-day exclusive" data-day="2">Tue<br><small>Exclusive</small></div>
        <div class="schedule-day public" data-day="3">Wed<br><small>Public Blast</small></div>
        <div class="schedule-day inbound" data-day="4">Thu<br><small>Inbound + Hunts</small></div>
        <div class="schedule-day inbound" data-day="5">Fri<br><small>Inbound + Hunts</small></div>
      </div>
      <div class="schedule-legend">
        <div class="legend-item"><div class="legend-dot blue"></div>Mon-Tue: Exclusive buyer list push</div>
        <div class="legend-item"><div class="legend-dot green"></div>Wed: Public blast everywhere</div>
        <div class="legend-item"><div class="legend-dot yellow"></div>Thu-Fri: Inbound + buyer hunts</div>
      </div>
    </div>
  </section>
  <!-- Engine Grids -->
  <div id="engines-container"></div>
</main>

<script>
const API = 'https://gunner-engine-production.up.railway.app';

// Static bot definitions (layout + descriptions). Real status comes from API.
// engineKey maps to ENGINE_<KEY>=active env vars on Railway
// Consolidated: no single-bot groups. Logical grouping by function.
// Readiness levels: 'built' â†’ 'testing' â†’ 'review' â†’ 'approved'
// built = just coded, not tested yet
// testing = running in test mode, collecting data
// review = ready for Corey to review and approve
// approved = Corey approved, ready to go live
const engineLayout = [
  // â”€â”€â”€ NEW LEAD PROCESSING â”€â”€â”€
  {id:'new-lead-chain',name:'New Lead Processing',apiId:'lead-iq',engineKey:'lead_iq',bots:[
    {name:'Data Cleaner',icon:'ğŸ§¹',readiness:'approved',desc:'Name cleanup, address normalization, business name = street address, timezone, market/state/ppl tags, mailing address via RentCast.'},
    {name:'Lead IQ Scorer',icon:'ğŸ§ ',readiness:'approved',desc:'Scores on 5 factors (motivation, timeline, condition, price, source). HOT/WARM tag, pipeline move, task, email. After-hours â†’ 9am queue. All leads â†’ Daniel.'},
    {name:'New Lead Watchdog',icon:'ğŸ•',readiness:'approved',desc:'SLA accountability â€” 2 manual calls within 30 min. Detects outbound calls (excludes automated). After-hours leads queue for 9am. Persists to disk. Notifications off (log only).'},
    {name:'New Lead Responder',icon:'âš¡',readiness:'approved',desc:'Immediate SMS with A/B testing. Source-aware (branded for PPL/forms). Quiet hours hold until 8:05am. Learning loop via Message Intelligence.'},
    {name:'Speed to Lead',icon:'â±ï¸',readiness:'approved',desc:'Tracks lead arrival â†’ first contact attempt. Stats by team member, source, day. Leaderboard. Read-only measurement.'},
  ]},

  // â”€â”€â”€ CALL & CONVERSATION â”€â”€â”€
  {id:'call-conversation',name:'Call & Conversation',apiId:'call-summary',engineKey:'call_summary',bots:[
    {name:'Call Summary',icon:'ğŸ“',readiness:'approved',desc:'Generates rich call summaries with property details, motivation, timeline, next steps. Notes only â€” no tags.'},
    {name:'Voicemail Bot',icon:'ğŸ¤',readiness:'testing',desc:'CallRail integration â€” polls every 30 min, matches voicemails to GHL contacts, classifies urgency.'},
  ]},

  // â”€â”€â”€ WORKING LEADS â”€â”€â”€
  {id:'new-lead-drip',name:'New Lead Drip',apiId:'new-lead-drip',engineKey:'new_lead_drip',bots:[
    {name:'104-Day Drip Engine',icon:'ğŸ“²',readiness:'approved',desc:'SMS + email sequence for leads that didn\'t answer first call. 26 touchpoints over 104 days. Stops on reply, callback, or DNC. Classifies replies (real/brushoff/DNC). A/B tests variations. Sends as assigned team member.'},
  ]},

  // â”€â”€â”€ FOLLOW-UP â”€â”€â”€
  {id:'followup',name:'Follow-Up System',apiId:'followup',engineKey:'follow_up',bots:[
    {name:'Entry Router',icon:'ğŸšª',readiness:'testing',desc:'Routes contacts from Sales Process â†’ Follow Up pipeline. Handles tagging, New Lead Drip removal.'},
    {name:'Organizer',icon:'ğŸ“‹',readiness:'testing',desc:'Motivation scoring (0-10), delta analysis, competitor/MLS detection. Daily sweep at 7am.'},
    {name:'Messenger',icon:'ğŸ’¬',readiness:'testing',desc:'Personalized re-engagement SMS + email for 4 Month and 12 Month buckets. 35/day cap.'},
    {name:'Closer',icon:'ğŸ”¥',readiness:'built',desc:'Converts re-engaged leads back to Sales Process. Needs Appointment Bot live first.'},
  ]},

  // â”€â”€â”€ APPOINTMENTS & SCHEDULING â”€â”€â”€
  {id:'scheduling',name:'Appointments & Scheduling',apiId:'scheduling',engineKey:'scheduling',bots:[
    {name:'Appointment Bot',icon:'ğŸ“…',readiness:'built',desc:'Confirmation SMS, day-before + 1-hour reminders, no-show detection. Drive time buffer for Kyle.'},
    {name:'Scheduling Coordinator',icon:'ğŸ—“ï¸',readiness:'built',desc:'Manages AM availability, prevents double-booking, detects calendar conflicts.'},
    {name:'Callback Capture',icon:'ğŸ“²',readiness:'testing',desc:'Monitors voicemails and missed calls. Auto-creates call tasks for the right team member.'},
  ]},

  // â”€â”€â”€ DEALS & DISPO â”€â”€â”€
  {id:'deals',name:'Deals & Distribution',apiId:'deals',engineKey:'deals',bots:[
    {name:'Contract Tracker',icon:'ğŸ“',readiness:'review',desc:'Triggers on Under Contract only. Tracks signature status, deadlines, closing timeline.'},
    {name:'Deal Packaging',icon:'ğŸ“¦',readiness:'review',desc:'Scores deal completeness (photos, ARV, repairs, comps). Signals "ready to market".'},
    {name:'Deal Packager',icon:'ğŸ“¦',readiness:'testing',desc:'Auto-generates PDF + email template for distribution.'},
    {name:'Schedule Engine',icon:'ğŸ“…',readiness:'built',desc:'Weekly cadence: Mon/Tue exclusive, Wed public blast, Thu/Fri inbound + hunts.'},
    {name:'Platform Distributor',icon:'ğŸš€',readiness:'built',desc:'Pushes to InvestorLift, Mevlo, Facebook. Tracks views and responses.'},
    {name:'Buyer Hunt Support',icon:'ğŸ¯',readiness:'built',desc:'Generates outreach lists for listing agents near deal. Pre-writes scripts.'},
    {name:'48-Hour Clock',icon:'â°',readiness:'built',desc:'Tracks marketing start, escalates at 12h/24h/36h/48h if no buyer interest.'},
  ]},

  // â”€â”€â”€ PIPELINE MONITORING â”€â”€â”€
  {id:'monitoring',name:'Pipeline Monitoring',apiId:'crm-scanner',engineKey:'crm_scanner',bots:[
    {name:'Pipeline Signals',icon:'ğŸ“¡',readiness:'testing',desc:'14 detection rules across 3 tiers (Missed/At Risk/Worth a Look). Scans pipeline health hourly.'},
    {name:'Deep Scan',icon:'ğŸ”¬',readiness:'testing',desc:'Every 4 hours â€” comprehensive lost deal audit. Detects competitor mentions, stall tactics, pricing disconnects.'},
    {name:'Ghosted Detector',icon:'ğŸ‘»',readiness:'testing',desc:'12 days + 15 outbound attempts with 0 real replies = Ghosted. Moves to Ghosted stage.'},
    {name:'Walkthrough SLA',icon:'ğŸƒ',readiness:'testing',desc:'24h+ stuck in Walkthrough Apt Scheduled = breach. AM offer task created 3h after walkthrough ends.'},
  ]},

  // â”€â”€â”€ MESSAGING & TASKS â”€â”€â”€
  {id:'messaging',name:'Messaging & Tasks',apiId:'message-queue',engineKey:'message_queue',bots:[
    {name:'Message Queue',icon:'ğŸ“¨',readiness:'approved',desc:'ALL outbound SMS + email routes through here. Send windows (9am-7pm), dedup, priority queue. Cancels on reply/callback/call. Sends as assigned team member.'},
    {name:'Task Manager',icon:'ğŸ“‹',readiness:'approved',desc:'Centralized task creation for all engines. 2-hour dedup window. Assigns to correct team member.'},
    {name:'Opportunity Conductor',icon:'ğŸ¯',readiness:'testing',desc:'Single authority on CRM state. Pipeline moves, user assignment, contact locking.'},
    {name:'Message Optimizer',icon:'ğŸ”§',readiness:'testing',desc:'Daily analysis at 6am. Flags underperforming SMS templates, recommends replacements.'},
  ]},

  // â”€â”€â”€ REPORTING & KPIs â”€â”€â”€
  {id:'reporting',name:'Reporting & KPIs',apiId:'reporting',engineKey:'reporting',bots:[
    {name:'KPI Calculator',icon:'ğŸ“Š',readiness:'review',desc:'Tracks total leads, net leads, appointments, offers, contracts, deals closed â€” by source and market.'},
    {name:'Offer Logger',icon:'ğŸ’µ',readiness:'review',desc:'Kyle texts "offer [address] [amount]" to log in-person offers. 90-day dedup per contact.'},
    {name:'Team Digest',icon:'ğŸ‘¥',readiness:'testing',desc:'Hourly activity digest â€” who\'s active, call volumes, conversation counts.'},
  ]},

  // â”€â”€â”€ COMING SOON â”€â”€â”€
  {id:'standalone',name:'Coming Soon',apiId:null,engineKey:null,bots:[
    {name:'Disposition Advisor',icon:'ğŸ¯',readiness:'testing',desc:'Freshly built â€” pipeline-aware playbooks (Sales Process, Follow-Up, Dispo). Building & testing. Dead = only legal/sold/unviable.'},
    {name:'PPL Refund Bot',icon:'ğŸ’°',readiness:'built',desc:'Files lead disputes on PropertyLeads and MotivatedSellers. Playwright automation.'},
    {name:'ARV Assistant',icon:'ğŸ—ï¸',readiness:'built',desc:'Grades properties from Street View, calculates construction budget using NAH franchise grading system.'},
    {name:'Market Watch',icon:'ğŸ“ˆ',readiness:'built',desc:'Tracks market trends, comparable sales, pricing shifts. Daily market intelligence.'},
    {name:'MLS Monitor',icon:'ğŸ ',readiness:'built',desc:'Alerts team when a pipeline property gets listed on MLS.'},
  ]}
];

let engineData = {};   // keyed by apiId
let allLogs = [];
let connected = false;
let dryRunMode = false;
let engineStatuses = {};

function timeAgo(ts) {
  if (!ts) return 'â€”';
  const diff = (Date.now() - new Date(ts).getTime()) / 1000;
  if (diff < 60) return Math.round(diff) + 's ago';
  if (diff < 3600) return Math.round(diff / 60) + 'm ago';
  if (diff < 86400) return Math.round(diff / 3600) + 'h ago';
  return Math.round(diff / 86400) + 'd ago';
}

function fetchWithTimeout(url, ms = 10000) {
  const ctrl = new AbortController();
  const tid = setTimeout(() => ctrl.abort(), ms);
  return fetch(url, { signal: ctrl.signal }).finally(() => clearTimeout(tid));
}

async function fetchData() {
  try {
    const badge = document.getElementById('conn-badge');
    if (!connected) { badge.textContent = 'ğŸŸ¡ Loadingâ€¦'; badge.className = 'connection-badge disconnected'; }

    const [statusRes, enginesRes, logsRes] = await Promise.all([
      fetchWithTimeout(API + '/api/status'),
      fetchWithTimeout(API + '/api/engines'),
      fetchWithTimeout(API + '/api/logs/recent?limit=50')
    ]);
    if (!statusRes.ok || !enginesRes.ok) throw new Error('API error ' + statusRes.status);

    const status = await statusRes.json();
    const engData = await enginesRes.json();
    allLogs = await logsRes.json();
    dryRunMode = status.dryRun;
    engineStatuses = status.engineStatuses || {};

    // Index engine data by id
    engineData = {};
    (engData.engines || []).forEach(e => { engineData[e.id] = e; });

    connected = true;
    updateConnectionBadge();
    render();
  } catch (err) {
    console.error('Failed to fetch engine data:', err);
    connected = false;
    const badge = document.getElementById('conn-badge');
    badge.className = 'connection-badge disconnected';
    badge.textContent = err.name === 'AbortError' ? 'ğŸ”´ Timeout â€” retryingâ€¦' : 'ğŸ”´ Disconnected â€” retryingâ€¦';
  }
}

function updateConnectionBadge() {
  const badge = document.getElementById('conn-badge');
  if (connected) {
    badge.className = 'connection-badge connected';
    badge.textContent = 'ğŸŸ¢ Connected to Engine';
  } else {
    badge.className = 'connection-badge disconnected';
    badge.textContent = 'ğŸ”´ Disconnected';
  }
  document.getElementById('last-refresh').textContent = 'Updated ' + new Date().toLocaleTimeString();
}

function getEngineStatus(apiId, engineKey) {
  if (!connected || !apiId) return 'offline';
  // Per-engine activation check â€” if engine is in dry-run, show as dry-run regardless of log activity
  if (engineKey && engineStatuses[engineKey] === 'dry-run') return 'dry-run';
  if (engineKey && engineStatuses[engineKey] === 'active') {
    const e = engineData[apiId];
    if (e && e.status === 'online') return 'online';
    return 'standby'; // active but no recent activity
  }
  const e = engineData[apiId];
  return e ? e.status : 'offline';
}

function getBotStatus(engineApiId, engineKey) {
  return getEngineStatus(engineApiId, engineKey);
}

function getEngineLogs(apiId) {
  if (!apiId || !engineData[apiId]) return [];
  return (engineData[apiId].recentLogs || []);
}

function highlightTodaySchedule() {
  const today = new Date().getDay(); // 0=Sun, 1=Mon, ..., 5=Fri, 6=Sat
  document.querySelectorAll('.schedule-day').forEach(day => {
    day.classList.remove('today');
    if (parseInt(day.dataset.day) === today) {
      day.classList.add('today');
    }
  });
}

function render() {
  const main = document.getElementById('engines-container');
  main.innerHTML = '';
  highlightTodaySchedule();
  let totalOnline = 0, totalIdle = 0, totalOffline = 0;

  engineLayout.forEach(eng => {
    const section = document.createElement('div');
    section.className = 'engine';
    // Determine group readiness from individual bot readiness levels
    const readinessOrder = {approved:4, review:3, testing:2, built:1};
    const botReadiness = eng.bots.map(b => b.readiness || 'built');
    const minReadiness = botReadiness.reduce((min, r) => readinessOrder[r] < readinessOrder[min] ? r : min, 'approved');
    const maxReadiness = botReadiness.reduce((max, r) => readinessOrder[r] > readinessOrder[max] ? r : max, 'built');
    const readinessLabels = {approved:'âœ… APPROVED', review:'ğŸŸ¡ READY FOR REVIEW', testing:'ğŸ”µ TESTING', built:'âšª FRESHLY BUILT'};
    const readinessBadgeClass = {approved:'online', review:'idle', testing:'dryrun', built:'offline'};
    const statusLabel = readinessLabels[maxReadiness] || 'BUILT';
    const badgeClass = readinessBadgeClass[maxReadiness] || 'offline';
    const engInfo = engineData[eng.apiId];
    const lastScan = engInfo ? timeAgo(engInfo.lastRunTime) : 'â€”';
    const actionCount = engInfo ? (engInfo.actionCount || 0) : 0;
    const statusDesc = engInfo ? (engInfo.statusDescription || '') : '';

    section.innerHTML = `<div class="engine-header">
      <span class="engine-badge ${badgeClass}">${statusLabel}</span>
      <span class="engine-title">${eng.name}</span>
      <span class="engine-subtitle">${eng.bots.length} bot${eng.bots.length > 1 ? 's' : ''} Â· ${actionCount} action${actionCount !== 1 ? 's' : ''} today Â· ${statusDesc}</span>
    </div><div class="desk-grid" id="grid-${eng.id}"></div>`;
    main.appendChild(section);
    const grid = document.getElementById('grid-' + eng.id);

    eng.bots.forEach(bot => {
      const botReadiness = bot.readiness || 'built';
      const readinessMap = {approved:'online', review:'idle', testing:'dryrun', built:'offline'};
      const botDisplayStatus = readinessMap[botReadiness] || 'offline';
      if (botReadiness === 'approved') totalOnline++;
      else if (botReadiness === 'review') totalIdle++;
      else totalOffline++;

      const card = document.createElement('div');
      card.className = `desk status-${botDisplayStatus}`;
      const engInfo = engineData[eng.apiId];
      const engLogs = getEngineLogs(eng.apiId);
      const lastActionTime = engInfo && engInfo.lastActionTime ? timeAgo(engInfo.lastActionTime) : (engLogs[0] ? timeAgo(engLogs[0].timestamp) : 'â€”');
      const lastActionText = engInfo && engInfo.lastAction ? engInfo.lastAction : '';
      const actionCount = engInfo ? (engInfo.actionCount || 0) : 0;
      const readinessText = {
        approved: '<span style="color:var(--green)">âœ… Approved</span>',
        review: '<span style="color:var(--yellow)">ğŸŸ¡ Ready for Review</span>',
        testing: '<span style="color:var(--blue)">ğŸ”µ Testing</span>',
        built: '<span style="color:var(--text-dim)">âšª Freshly Built</span>'
      };
      const statusText = readinessText[botReadiness] || readinessText.built;

      const cardDesc = bot.desc.substring(0, 80) + (bot.desc.length > 80 ? 'â€¦' : '');

      const actionBadge = actionCount > 0 ? `${actionCount} action${actionCount !== 1 ? 's' : ''}` : lastActionTime;

      card.innerHTML = `<div class="desk-top">
        <div class="bot-avatar ${botDisplayStatus}">${bot.icon}<div class="status-dot ${botDisplayStatus}"></div></div>
        <div class="desk-actions">${actionBadge}</div>
      </div>
      <div class="bot-name">${bot.name}</div>
      <div class="bot-desc">${cardDesc}</div>
      <div class="bot-meta">
        <span class="bot-status-text ${botDisplayStatus}">${statusText}</span>
      </div>`;
      card.onclick = () => openPanel(bot, eng);
      grid.appendChild(card);
    });
  });

  document.getElementById('cnt-online').textContent = totalOnline;
  document.getElementById('cnt-idle').textContent = totalIdle;
  document.getElementById('cnt-offline').textContent = totalOffline;
  document.getElementById('cnt-total').textContent = totalOnline + totalIdle + totalOffline;
}

function openPanel(bot, eng) {
  const botReadiness = bot.readiness || 'built';
  const readinessMap = {approved:'online', review:'idle', testing:'dryrun', built:'offline'};
  const displayStatus = readinessMap[botReadiness] || 'offline';
  document.getElementById('p-avatar').className = 'panel-avatar bot-avatar ' + displayStatus;
  document.getElementById('p-avatar').innerHTML = bot.icon;
  document.getElementById('p-name').textContent = bot.name;
  document.getElementById('p-engine').textContent = eng.name;
  document.getElementById('p-desc').textContent = bot.desc;

  const dryBadge = document.getElementById('p-dryrun');
  const readinessLabels = {approved:'APPROVED', review:'READY FOR REVIEW', testing:'TESTING', built:'FRESHLY BUILT'};
  const readinessColors = {approved:'var(--green)', review:'var(--yellow)', testing:'var(--blue)', built:'var(--text-dim)'};
  dryBadge.style.display = 'inline-block';
  dryBadge.textContent = readinessLabels[botReadiness] || 'BUILT';
  dryBadge.style.background = readinessColors[botReadiness] || 'var(--text-dim)';
  if (botReadiness === 'approved' || botReadiness === 'review') {
    dryBadge.style.color = '#000';
  } else {
    dryBadge.style.color = '#fff';
  }

  // Metrics from real data
  const engInfo = engineData[eng.apiId];
  const mg = document.getElementById('p-metrics');
  mg.innerHTML = '';
  if (engInfo) {
    const readinessEmoji = {approved:'âœ…', review:'ğŸŸ¡', testing:'ğŸ”µ', built:'âšª'};
    const metrics = [
      { v: engInfo.actionCount || 0, l: 'Actions Today' },
      { v: readinessEmoji[botReadiness] || 'âšª', l: 'Readiness' },
      { v: engInfo.lastActionTime ? timeAgo(engInfo.lastActionTime) : 'â€”', l: 'Last Action' },
      { v: readinessLabels[botReadiness] || 'BUILT', l: 'Status' }
    ];
    metrics.forEach(m => {
      mg.innerHTML += `<div class="metric"><div class="val">${m.v}</div><div class="mlabel">${m.l}</div></div>`;
    });
  } else {
    mg.innerHTML = '<div class="metric"><div class="val">â€”</div><div class="mlabel">No data</div></div>';
  }

  // Activity from real logs
  const ag = document.getElementById('p-activity');
  ag.innerHTML = '';
  const logs = getEngineLogs(eng.apiId);
  if (logs.length === 0) {
    ag.innerHTML = '<div style="color:var(--text-dim);font-size:13px;padding:12px 0;">No recent activity from this engine.</div>';
  } else {
    logs.forEach(l => {
      ag.innerHTML += `<div class="activity-item"><div class="activity-dot"></div><div><div class="activity-text">${l.description || l.operation}</div><div class="activity-time">${timeAgo(l.timestamp)}</div></div></div>`;
    });
  }

  document.getElementById('overlay').classList.add('open');
  document.getElementById('panel').classList.add('open');
}

function closePanel() {
  document.getElementById('overlay').classList.remove('open');
  document.getElementById('panel').classList.remove('open');
}

document.addEventListener('keydown', e => { if (e.key === 'Escape') closePanel(); });

// Initial load + auto-refresh every 30s
fetchData();
setInterval(fetchData, 30000);
</script>
</body>
</html>
